---
title: "A movie recommendation system"
output:
  html_document: default
  pdf_document: default
---
```{r, include=FALSE}
if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(caret)) install.packages("caret", repos = "http://cran.us.r-project.org")
if(!require(data.table)) install.packages("data.table", repos = "http://cran.us.r-project.org")

# MovieLens 10M dataset:
# https://grouplens.org/datasets/movielens/10m/
# http://files.grouplens.org/datasets/movielens/ml-10m.zip

dl <- tempfile()
download.file("http://files.grouplens.org/datasets/movielens/ml-10m.zip", dl)

ratings <- fread(text = gsub("::", "\t", readLines(unzip(dl, "ml-10M100K/ratings.dat"))),
                 col.names = c("userId", "movieId", "rating", "timestamp"))

movies <- str_split_fixed(readLines(unzip(dl, "ml-10M100K/movies.dat")), "\\::", 3)
colnames(movies) <- c("movieId", "title", "genres")
movies <- as.data.frame(movies) %>% mutate(movieId = as.numeric(levels(movieId))[movieId],
                                           title = as.character(title),
                                           genres = as.character(genres))

movielens <- left_join(ratings, movies, by = "movieId")

# Validation set will be 10% of MovieLens data

set.seed(1, sample.kind="Rounding")
# if using R 3.5 or earlier, use `set.seed(1)` instead
test_index <- createDataPartition(y = movielens$rating, times = 1, p = 0.1, list = FALSE)
edx <- movielens[-test_index,]
temp <- movielens[test_index,]

# Make sure userId and movieId in validation set are also in edx set

validation <- temp %>% 
  semi_join(edx, by = "movieId") %>%
  semi_join(edx, by = "userId")

# Add rows removed from validation set back into edx set

removed <- anti_join(temp, validation)
edx <- rbind(edx, removed)

rm(dl, ratings, movies, test_index, temp, movielens, removed)
```

## Introduction

The dataset is downloaded, tweaked and then split into edx and validation sets in proportions of 90% and 10% respectively. While the validation set has been set aside for testing purposes, i have further split the edx set into train and test sets in proportions of 50% to 50% for intermediate  training, testing and cross-validation purposes. 

With this dataset of 6 columns and a total of 10,000,054 rows(both the edx and validation sets), i have modelled a recommendation sytem that predicts movie ratings using different predictors. This has been achieved by training the train set using a linear regression approximation model to predict movie ratings of the test set.Since the RMSE obtained between predicted ratings of the test set and the actual ratings of the test set is satisfactory, other models have not been   tried.To make the final tests, the same training approach has been adopted to train the whole edx set(not split this time round) before getting predictions of ratings of the validation set, that are then compared with the actual ratings of the validation set using a RMSE function. 

Dimensions of the edx set
```{r, echo=FALSE}
dim(edx)
```
Dimensions of the validation set
```{r, echo=FALSE}
dim(validation)
```

Overview of the data
```{r, echo=FALSE}
head(edx)
```

## Methods


```{r}

tidyr::gather(sample(edx,20,replace = TRUE), key=title,value=rating, -userId)
```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
